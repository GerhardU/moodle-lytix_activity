define("lytix_activity/activity",["exports","core/ajax","core/templates","lytix_helper/widget","lytix_helper/percent_rounder","lytix_logs/logs"],(function(_exports,_ajax,_templates,_widget,_percent_rounder,_logs){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_widget=_interopRequireDefault(_widget),_percent_rounder=_interopRequireDefault(_percent_rounder);_exports.init=(contextid,courseid,userid)=>{const dataPromise=_widget.default.getData("local_lytix_lytix_activity_logs_get",{contextid:contextid,courseid:courseid,userid:userid}).then((data=>{const times=data.Times,length=times.length;for(let i=0;i<length;++i)if(times[i].Me>0||times[i].Others>0)return data;throw new _widget.default.NoDataError})),stringPromise=_widget.default.getStrings({lytix_activity:{differing:{Navigation:"core",Quiz:"quiz",Video:"video",Grade:"grade",Forum:"forum",Resource:"resource",Submission:"submission",noData:"nodata"}}}),widget=document.getElementById("activity"),log=(0,_logs.makeLoggingFunction)(userid,courseid,contextid,"activity");Promise.all([stringPromise,dataPromise]).then((values=>{const strings=values[0],data=values[1],times=data.Times,length=times.length,rounder=new _percent_rounder.default,generateChartContext=target=>{const context=[];for(let i=0;i<length;++i){const entry=times[i],time=entry[target];time<=0||context.push({activity:entry.Type.toLowerCase(),label:strings[entry.Type],percent:rounder.round(100*time)})}return rounder.reset(),context.length>0&&{data:context}};return _templates.default.render("lytix_activity/activity",{me:generateChartContext("Me"),others:generateChartContext("Others"),showOthers:data.ShowOthers})})).then((html=>{widget.querySelector(".content").innerHTML=html;const barChartOthers=widget.querySelector(".others");document.getElementById("show-others").addEventListener("change",(e=>{const checked=e.target.checked;_ajax.default.call([{methodname:"local_lytix_lytix_activity_toggle_others",args:{userid:userid,courseid:courseid,contextid:contextid,showothers:checked}}]),checked?(barChartOthers.classList.remove("d-none"),log("SHOW","OTHERS")):(barChartOthers.classList.add("d-none"),log("HIDE","OTHERS"))}))})).finally((()=>{widget.classList.remove("loading")})).catch((error=>_widget.default.handleError(error,"activity")))}}));

//# sourceMappingURL=activity.min.js.map